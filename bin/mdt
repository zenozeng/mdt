#!/bin/bash

set -e

export BASEDIR=$(dirname "$0")/..
export WORKDIR=$(mktemp -d /tmp/mdt-XXXXXXXX)

docker_run() {
    docker run -i -v $WORKDIR:/home/mdt/workdir -v $(pwd):$(pwd) -w /home/mdt/workdir -e SOURCE_DIR=$(pwd) $@
}

case "$1" in
    bash)
        docker_run -t mdt mdt-run bash
        ;;
    root)
        docker_run -u root -t mdt bash
        ;;
    docker)
        docker build -t mdt $BASEDIR
        ;;
    pdf)
        cat - > $WORKDIR/input.md
        docker_run -e OUTPUT=$(pwd)/output.pdf mdt mdt-run mdt-pdf "${@:2}"
        ;;
    *)
cat <<EOF
mdt
Markdown toolkit

Usage:

- Build docker image
  mdt docker

- Convert markdown to pdf
  cat examples/beamer.md | mdt pdf
EOF
        ;;
esac